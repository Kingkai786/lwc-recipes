Trigger

trigger OpportunityTrigger on Opportunity (after insert, after update, after delete, after undelete) {
    OpportunityTriggerHandler.updateAccountRollup(Trigger.new, Trigger.oldMap, Trigger.newMap, Trigger.isUpdate, Trigger.isDelete);
}

Helper Class
public class OpportunityTriggerHandler {
    public static void updateAccountRollup(List<Opportunity> newList, Map<Id, Opportunity> oldMap, Map<Id, Opportunity> newMap, Boolean isUpdate) {
        Set<Id> accountIds = new Set<Id>();
        
        if (!isDelete && newList != null) {
            for (Opportunity opp : newList) {
                if (isUpdate && opp.AccountId != null && opp.Amount != oldMap.get(opp.id).amount) {
                        accountIds.add(opp.AccountId);
                } else {
                    // It's an Insert or Undelete
                    if (opp.AccountId != null) accountIds.add(opp.AccountId);
                }
            }
        }
        
        Collect Account IDs for Delete
        if (isDelete && oldMap != null) {
            for (Opportunity oldOpp : oldMap.values()) {
                if (oldOpp.AccountId != null) {
                    accountIds.add(oldOpp.AccountId);
                }
            }
        }
        
        if (accountIds.isEmpty()) return;
        
        // Aggregate query for bulk calculation
        List<AggregateResult> aggregates = [
            SELECT AccountId, COUNT(Id) oppCount, SUM(Amount) oppSum
            FROM Opportunity
            WHERE AccountId IN :accountIds
            GROUP BY AccountId
        ];
        
        // Map results for efficient updates
        Map<Id, Account> accountsToUpdate = new Map<Id, Account>();

        for(Id accdId: accountIds){
            accountsToUpdate.put(accdId, new account(Id=accId,Number_of_Opportunities__c=0,Total_Opportunities_Amount__c=0));
        }

        for (AggregateResult ar : aggregates) {
            Account acc = new Account(
                Id = (Id)ar.get('AccountId'),
                Number_of_Opportunities__c = ar.get('oppCount') ? (Decimal)ar.get('oppCount') : 0,
                Total_Opportunities_Amount__c = ar.get('oppSum') ? (Decimal)ar.get('oppSum') : 0
            );
            accountsToUpdate.put(acc.Id, acc);
        }
        aggregates = new List<AggregateResult>();
        
        // Update only changed Accounts (bulk DML)
        if (!accountsToUpdate.isEmpty()) {
            update accountsToUpdate.values();
        }
    }
}
